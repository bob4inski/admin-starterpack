# День 3: Устройство Linux и процессы

## Теоретическая часть (лекция): Устройство Linux и процессы

### 1. Базовые команды в терминале
- Повторение и углубление знаний о базовых командах
- Команды для работы с текстом: cat, echo, printf, tee
- Команды для работы с архивами: tar, gzip, zip
- Команды для мониторинга системы: top, htop, iotop
- Команды для работы с сетью: ping, traceroute, netstat

### 2. Устройство Linux: файловая структура
- Философия Unix: "всё есть файл"
- Иерархия файловой системы Linux (FHS - Filesystem Hierarchy Standard)
- Основные директории и их назначение:
  - `/bin` - основные исполняемые файлы
  - `/sbin` - системные исполняемые файлы
  - `/etc` - конфигурационные файлы
  - `/var` - переменные данные (логи, кэши)
  - `/home` - домашние директории пользователей
  - `/root` - домашняя директория суперпользователя
  - `/tmp` - временные файлы
  - `/usr` - программы и данные для пользователей
  - `/proc` - виртуальная файловая система с информацией о процессах
  - `/sys` - информация о устройствах и драйверах
  - `/dev` - файлы устройств

### 3. Дискреционная модель доступа
- Пользователи и группы в Linux
- Права доступа: чтение (r), запись (w), выполнение (x)
- Восьмеричное представление прав доступа
- Команды для управления правами:
  - `chmod` - изменение прав доступа
  - `chown` - изменение владельца
  - `chgrp` - изменение группы
- Специальные права доступа: SUID, SGID, sticky bit
- Списки контроля доступа (ACL)

### 4. Процессы и procfs
- Что такое процесс
- Атрибуты процесса: PID, PPID, UID, GID, состояние
- Жизненный цикл процесса
- Иерархия процессов
- Виртуальная файловая система /proc:
  - `/proc/[PID]` - информация о конкретном процессе
  - `/proc/cpuinfo` - информация о процессоре
  - `/proc/meminfo` - информация о памяти
  - `/proc/filesystems` - поддерживаемые файловые системы
  - `/proc/mounts` - смонтированные файловые системы

### 5. Сигналы процессам
- Что такое сигналы
- Основные сигналы:
  - `SIGTERM` (15) - корректное завершение
  - `SIGKILL` (9) - принудительное завершение
  - `SIGINT` (2) - прерывание (Ctrl+C)
  - `SIGSTOP` (19) - остановка процесса
  - `SIGCONT` (18) - продолжение остановленного процесса
- Отправка сигналов процессам
- Обработка сигналов в приложениях

### 6. Системные вызовы
- Что такое системные вызовы
- Различие между системными вызовами и библиотечными функциями
- Основные системные вызовы:
  - `fork()` - создание нового процесса
  - `exec()` - замена образа процесса
  - `wait()` - ожидание завершения дочернего процесса
  - `open()` - открытие файла
  - `read()` - чтение из файла
  - `write()` - запись в файл
  - `close()` - закрытие файла
- Отслеживание системных вызовов с помощью `strace`

## Практическая часть: Команды для работы в терминале

### 1. Работа с процессами
- Команды для просмотра процессов:
  - `ps` - отображение процессов
  - `top` - интерактивный просмотр процессов
  - `htop` - улучшенная версия top
  - `pstree` - отображение процессов в виде дерева
- Управление процессами:
  - `kill` - отправка сигналов процессам
  - `killall` - завершение процессов по имени
  - `nice`/`renice` - изменение приоритета процессов
  - `nohup` - выполнение команд после завершения сессии

### 2. Команды для работы с файловой системой и дисками
- Просмотр использования дискового пространства:
  - `df` - информация о файловых системах
  - `du` - использование дискового пространства директориями
  - `lsblk` - отображение блочных устройств
- Работа с файлами:
  - `find` - поиск файлов
  - `locate` - быстрый поиск файлов по базе
  - `which` - поиск исполняемых файлов
  - `file` - определение типа файла

### 3. Работа с текстом и данными
- Фильтрация и обработка текста:
  - `grep` - поиск текста по шаблону
  - `sed` - потоковый редактор текста
  - `awk` - обработка структурированного текста
  - `sort` - сортировка строк
  - `uniq` - удаление повторяющихся строк
- Работа с содержимым файлов:
  - `head`/`tail` - начало/конец файла
  - `wc` - подсчёт строк, слов и символов
  - `cut` - вырезание столбцов
  - `paste` - объединение файлов

### 4. Работа с архивами
- Создание и извлечение архивов:
  - `tar` - работа с tar-архивами
  - `gzip`/`gunzip` - сжатие и распаковка gzip
  - `zip`/`unzip` - работа с zip-архивами
- Комбинирование команд для создания сжатых архивов

### 5. Специальные команды и утилиты
- `dd` - побайтовое копирование и преобразование данных
- `watch` - периодическое выполнение команды
- `xargs` - передача аргументов команде
- `tee` - разделение потока данных
- `timeout` - ограничение времени выполнения команды

## Практическое задание: Работа с командами и однострочниками

### Цель
Научиться эффективно работать с командной строкой, комбинировать команды и создавать полезные однострочники.

### Задачи
1. Работа с процессами:
   - Найти все процессы определённого пользователя
   - Найти процессы, потребляющие больше всего памяти/CPU
   - Изменить приоритет процесса
   - Создать скрипт для мониторинга процессов

2. Работа с файловой системой:
   - Найти все файлы определённого типа
   - Найти файлы, изменённые за последние 24 часа
   - Подсчитать размер директории с учётом поддиректорий
   - Создать скрипт для очистки временных файлов

3. Работа с текстом:
   - Извлечь определённые столбцы из лог-файла
   - Подсчитать количество уникальных IP-адресов в логе
   - Найти все ошибки в лог-файле
   - Создать скрипт для анализа логов

4. Создание однострочников:
   - Однострочник для поиска и замены в файлах
   - Однострочник для переименования файлов по шаблону
   - Однострочник для мониторинга системных ресурсов
   - Однострочник с использованием регулярных выражений

## Дополнительные материалы

### Примеры полезных однострочников
```bash
# Найти 10 самых больших файлов в текущей директории
find . -type f -exec ls -lah {} \; | sort -rh | head -n 10

# Подсчитать количество подключений к серверу по портам
netstat -ntu | awk 'NR>1 {print $5}' | cut -d: -f1 | sort | uniq -c | sort -nr

# Найти все файлы с определённым расширением и заменить в них текст
find . -name "*.txt" -exec sed -i 's/old_text/new_text/g' {} \;

# Мониторинг загрузки системы в реальном времени
watch -n 1 "ps aux --sort=-%cpu | head -n 10"

# Создать резервную копию директории с датой в имени
tar -czf backup_$(date +%Y%m%d_%H%M%S).tar.gz /path/to/directory
```

### Регулярные выражения в grep
```bash
# Найти все email-адреса в файле
grep -E '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}' file.txt

# Найти все IP-адреса в лог-файле
grep -E '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' logfile

# Найти строки, начинающиеся с даты в формате ГГГГ-ММ-ДД
grep -E '^[0-9]{4}-[0-9]{2}-[0-9]{2}' file.txt
```

## Проверка знаний
1. Что такое дискреционная модель доступа?
2. Как работают права доступа в Linux?
3. Что такое процесс и каковы его основные атрибуты?
4. Какие основные сигналы вы знаете и для чего они используются?
5. Что такое системные вызовы и чем они отличаются от библиотечных функций?
6. Как найти процесс, потребляющий больше всего памяти?
7. Как создать архив сжатой директории?

## Домашнее задание
1. Изучить структуру файловой системы вашей системы
2. Создать скрипт для мониторинга системных ресурсов
3. Написать 5 полезных однострочников для системного администрирования
4. Подготовить отчёт о проделанной работе с примерами команд

## Критерии выполнения
- [ ] Понимание файловой структуры Linux
- [ ] Умение работать с правами доступа
- [ ] Навыки работы с процессами
- [ ] Умение использовать основные команды
- [ ] Созданы полезные однострочники
- [ ] Выполнено домашнее задание
