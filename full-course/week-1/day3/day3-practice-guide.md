# Практическое руководство: Команды для работы в терминале и однострочники

## Введение

Это практическое руководство поможет вам освоить работу с процессами, файловой системой и текстовыми данными в Linux. Вы научитесь эффективно использовать командную строку и создавать полезные однострочники для системного администрирования.

## Подготовка

### Требования
- Установленная система Linux (виртуальная или физическая)
- Базовые знания командной строки (из Дня 1)
- Права суперпользователя для некоторых команд

### Подготовка окружения
```bash
# Создайте рабочую директорию
mkdir -p ~/admin-course/day3
cd ~/admin-course/day3

# Создайте тестовые файлы для практики
echo "This is a test file" > test1.txt
echo "Another test file" > test2.txt
echo "Error: something went wrong" > error.log
echo "Warning: low disk space" > warning.log
echo "Info: system started" > info.log

# Создайте тестовую структуру директорий
mkdir -p project/{src,docs,tests}
touch project/src/main.c project/src/utils.c project/docs/README.md project/tests/test_main.c
```

## Задание 1: Работа с процессами

### 1.1 Просмотр процессов
```bash
# Показать все процессы
ps aux

# Показать процессы в виде дерева
pstree

# Показать процессы текущего пользователя
ps -u $USER

# Показать процессы в реальном времени
top
# или htop, если установлен
```

### 1.2 Поиск процессов
```bash
# Найти процессы по имени
ps aux | grep nginx

# Найти процессы определённого пользователя
ps -u username

# Найти процессы, потребляющие больше всего памяти
ps aux --sort=-%mem | head -n 10

# Найти процессы, потребляющие больше всего CPU
ps aux --sort=-%cpu | head -n 10
```

### 1.3 Управление процессами
```bash
# Запустить процесс в фоновом режиме
sleep 300 &

# Показать фоновые задачи
jobs

# Перевести фоновый процесс на передний план
fg %1

# Отправить сигнал процессу
kill -15 PID  # SIGTERM - корректное завершение
kill -9 PID   # SIGKILL - принудительное завершение

# Завершить процесс по имени
killall process_name

# Изменить приоритет процесса
nice -n 10 command  # запустить с низким приоритетом
renice 10 -p PID    # изменить приоритет существующего процесса
```

### Практическое задание
1. Найдите все процессы вашего пользователя
2. Найдите 5 процессов, потребляющих больше всего памяти
3. Запустите `sleep 300` в фоновом режиме
4. Измените приоритет фонового процесса
5. Завершите фоновый процесс

## Задание 2: Работа с файловой системой

### 2.1 Просмотр использования дискового пространства
```bash
# Показать информацию о файловых системах
df -h

# Показать использование дискового пространства директориями
du -sh *

# Найти 10 самых больших файлов в текущей директории
find . -type f -exec ls -lah {} \; | sort -rh | head -n 10

# Показать блочные устройства
lsblk
```

### 2.2 Поиск файлов
```bash
# Найти все файлы с расширением .txt
find . -name "*.txt"

# Найти все файлы, изменённые за последние 24 часа
find . -mtime -1

# Найти все файлы размером более 1MB
find . -size +1M

# Найти все пустые файлы
find . -empty

# Найти исполняемые файлы
find . -type f -executable
```

### 2.3 Работа с правами доступа
```bash
# Показать права доступа к файлам
ls -la

# Изменить права доступа
chmod 755 script.sh  # rwxr-xr-x
chmod +x script.sh   # добавить право на выполнение

# Изменить владельца файла
sudo chown user:group file.txt

# Показать права доступа в числовом формате
stat -c "%a %n" file.txt
```

### Практическое задание
1. Проверьте использование дискового пространства в вашей системе
2. Найдите все файлы с расширением .log в системе
3. Найдите файлы, изменённые за последнюю неделю
4. Создайте скрипт и сделайте его исполняемым
5. Измените права доступа для группы файлов

## Задание 3: Работа с текстом и данными

### 3.1 Поиск и фильтрация текста
```bash
# Найти строки, содержащие "error" в файле
grep "error" logfile.txt

# Найти строки, не содержащие "info"
grep -v "info" logfile.txt

# Поиск с учётом регистра
grep -i "error" logfile.txt

# Показать номер строки
grep -n "error" logfile.txt

# Подсчитать количество совпадений
grep -c "error" logfile.txt
```

### 3.2 Работа с потоками данных
```bash
# Показать первые 10 строк файла
head -n 10 file.txt

# Показать последние 10 строк файла
tail -n 10 file.txt

# Отслеживать изменения файла в реальном времени
tail -f logfile.txt

# Подсчитать строки, слова и символы
wc file.txt

# Только строки
wc -l file.txt
```

### 3.3 Сортировка и уникальные значения
```bash
# Отсортировать строки файла
sort file.txt

# Удалить дубликаты строк
sort file.txt | uniq

# Подсчитать количество уникальных строк
sort file.txt | uniq -c

# Отсортировать по числовому значению
sort -n numbers.txt
```

### Практическое задание
1. Создайте файл с логами и найдите все ошибки
2. Подсчитайте количество строк в файле
3. Найдите уникальные IP-адреса в лог-файле
4. Отсортируйте файл по алфавиту
5. Создайте файл с числами и отсортируйте их по возрастанию

## Задание 4: Продвинутая обработка текста

### 4.1 Использование sed
```bash
# Заменить текст в файле
sed 's/old_text/new_text/g' file.txt

# Удалить строки, содержащие определённый текст
sed '/pattern/d' file.txt

# Показать строки с определённого номера по определённый номер
sed -n '5,10p' file.txt

# Заменить текст и сохранить в файл
sed -i 's/old_text/new_text/g' file.txt
```

### 4.2 Использование awk
```bash
# Показать определённый столбец
awk '{print $1}' file.txt

# Показать строки, где первый столбец больше 100
awk '$1 > 100' file.txt

# Подсчитать сумму чисел в первом столбце
awk '{sum += $1} END {print sum}' file.txt

# Показать строки с определённым количеством полей
awk 'NF == 3' file.txt
```

### 4.3 Использование cut
```bash
# Вырезать определённые столбцы (разделитель - табуляция)
cut -f1,3 file.txt

# Вырезать символы с 1 по 5
cut -c1-5 file.txt

# Использовать другой разделитель
cut -d':' -f1,6 /etc/passwd
```

### Практическое задание
1. Используйте sed для замены всех вхождений "error" на "ERROR"
2. Используйте awk для подсчёта суммы чисел в файле
3. Используйте cut для извлечения имён пользователей из /etc/passwd
4. Создайте файл с данными и извлеките определённые столбцы
5. Объедините несколько команд для обработки данных

## Задание 5: Создание однострочников

### 5.1 Примеры полезных однострочников
```bash
# Найти 10 самых больших файлов в системе
find / -type f -exec ls -lah {} \; 2>/dev/null | sort -rh | head -n 10

# Подсчитать количество подключений к серверу
netstat -ntu | awk 'NR>1 {print $5}' | cut -d: -f1 | sort | uniq -c | sort -nr

# Найти все файлы с определённым расширением и заменить в них текст
find . -name "*.txt" -exec sed -i 's/old_text/new_text/g' {} \;

# Мониторинг загрузки системы
watch -n 1 "ps aux --sort=-%cpu | head -n 10"

# Создать резервную копию с датой в имени
tar -czf backup_$(date +%Y%m%d_%H%M%S).tar.gz /path/to/directory

# Найти все уникальные IP-адреса в лог-файле
grep -oE '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' access.log | sort | uniq

# Подсчитать количество ошибок в лог-файле за последний час
find /var/log -name "*.log" -mmin -60 -exec grep -c "ERROR" {} \; | awk '{sum += $1} END {print sum}'

# Проверить доступность хостов из файла
for host in $(cat hosts.txt); do ping -c 1 $host > /dev/null && echo "$host is up" || echo "$host is down"; done
```

### 5.2 Регулярные выражения
```bash
# Найти все email-адреса
grep -E '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}' file.txt

# Найти все URL
grep -E 'https?://[^\s]+' file.txt

# Найти все даты в формате ГГГГ-ММ-ДД
grep -E '[0-9]{4}-[0-9]{2}-[0-9]{2}' file.txt

# Найти все телефонные номера
grep -E '\+?[0-9]{1,3}[-.\s]?[0-9]{3}[-.\s]?[0-9]{4,7}' file.txt
```

### Практическое задание
1. Создайте однострочник для поиска 10 самых больших файлов в вашей домашней директории
2. Создайте однострочник для мониторинга системных ресурсов
3. Создайте однострочник для анализа лог-файла и подсчёта ошибок
4. Создайте однострочник для переименования файлов по шаблону
5. Создайте однострочник с использованием регулярных выражений

## Задание 6: Комбинирование команд

### 6.1 Использование pipe (|)
```bash
# Комбинирование команд для обработки данных
ps aux | grep nginx | awk '{print $2}' | xargs kill -9

# Поиск и обработка файлов
find . -name "*.log" | xargs grep "ERROR"

# Сортировка и подсчёт уникальных значений
cat access.log | awk '{print $1}' | sort | uniq -c | sort -nr
```

### 6.2 Использование xargs
```bash
# Удаление файлов по маске
find . -name "*.tmp" | xargs rm

# Копирование файлов
find . -name "*.jpg" | xargs -I {} cp {} /backup/

# Выполнение команды над несколькими файлами
ls *.txt | xargs -I {} sh -c 'echo "Processing {}" && cat {}'
```

### 6.3 Использование tee
```bash
# Вывод в файл и на экран
ls -la | tee filelist.txt

# Запись вывода команды в несколько файлов
command | tee file1.txt file2.txt

# Добавление в файл
command | tee -a logfile.txt
```

### Практическое задание
1. Используйте pipe для комбинирования нескольких команд
2. Используйте xargs для обработки списка файлов
3. Используйте tee для сохранения вывода команды
4. Создайте сложный однострочник, использующий несколько утилит
5. Создайте скрипт для автоматической очистки временных файлов

## Итоговое задание

Создайте скрипт, который:
1. Анализирует системные ресурсы (CPU, память, диск)
2. Находит файлы, которые можно безопасно удалить
3. Проверяет наличие ошибок в системных логах
4. Создаёт отчёт о состоянии системы
5. Отправляет отчёт по email (опционально)

## Критерии оценки

- **Отлично (5)**: Все задания выполнены, созданы сложные однострочники, понимание принципов работы команд
- **Хорошо (4)**: Основные задания выполнены, созданы простые однострочники
- **Удовлетворительно (3)**: Не менее 4 из 6 заданий выполнены
- **Неудовлетворительно (2)**: Менее 4 заданий выполнено

## Дополнительные ресурсы

- [GNU Coreutils](https://www.gnu.org/software/coreutils/manual/)
- [Awk tutorial](https://www.grymoire.com/Unix/Awk.html)
- [Sed tutorial](https://www.grymoire.com/Unix/Sed.html)
- [Regular Expressions Tutorial](https://www.regular-expressions.info/)
